<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="Author" content="Mike Owen">
   <title>Tensor Artificial Viscosity for SPH</title>
</head>
<body text="#FFFFFF" bgcolor="#C7C3C7" link="#66FFFF" vlink="#3366FF" alink="#FF0000" background="background.gif">

<blockquote>
<pre>&nbsp;</pre>

<center><table COLS=2 WIDTH="100%" NOSAVE >
<tr NOSAVE>
<a href="http://sourceforge.net"> 
<IMG src="http://sourceforge.net/sflogo.php?group_id=4943&type=5" width="210"
     height="62" border="0" alt="SourceForge Logo"></A>
<td>
</td>
</tr>
</table></center>

<hr ALIGN=LEFT WIDTH="100%"></blockquote>

<center>
<h1>
&nbsp;<a href="index.html">Back to Spheral++ main page</a></h1></center>

<center>
<hr WIDTH="100%"><font color="#CCFFFF">
<h1>The Tensor Artificial Viscosity in Spheral++</h1></font></center>
<font color="#FFFFFF">

<ul>
<li>
This page describes the version of Spheral++ used to prepare the paper on the
SPH tensor artificial viscosity.  Since Spheral++ is a living, evolving project,
the most recent version of Spheral++ will not necessarily run the test problem
set-up scripts identically with what is presented in the paper.  Therefore we
have set aside a CVS branch and cut a special release of Spheral++ specifically
to reproduce the results presented in the tensor viscosity methods paper.
</li>

<li>
The links below detail how to get the code and test problem set-ups, build, and
then run the various tests.
<ul>
  <li><a href="#Download">Getting the code</a></li>
  <li><a href="#Building">Building the code</a></li>
  <li><a href="#Tests">Running the test problems</a></li>
</ul>
</li>
</ul>

<hr>
<h3>
<a NAME="Download"></a>
<font color="#FF0000">Downloading the Code and Test Problems.</font>
</h3>
The code and test problems are bundled together, so you can download them in one
operation.  There are two possible methods of getting the appropriate source:
<ul>
<li>
<a href="http://prdownloads.sourceforge.net/spheral/Spheral++-TensorQ-release-2003-09-09.tgz?download">
Download the release.  
</a>
We have released the source frozen at the state used in producing the results
given in the tensor viscosity methods paper, which can be found on the Spheral++
releases page at this link.
</li>
<li>
The sources are also under a CVS branch of the Spheral++ depot, which can be
accessed by
<ol>
  <li>
  Make yourself a directory where you want to download the source and
  problems.
  </li>

  <li>
  cd into the directory you just made, and issue the following set of CVS
  commands:<br><br>
  cvs -d:pserver:anonymous@cvs.Spheral.sourceforge.net:/cvsroot/spheral login<br>
  cvs -z3 -d:pserver:anonymous@cvs.Spheral.sourceforge.net:/cvsroot/spheral co 
  -r Q_project src<br>
  cvs -d:pserver:anonymous@cvs.Spheral.sourceforge.net:/cvsroot/spheral logout<br>
  cd src/<br>
  cvs update -dP<br><br>
  </li>
</ol>
</li>
</ul>

Spheral++ depends on a core set of software that you must have, and there are
many optional packages you may want access to for use with Spheral.  At minimum
you must have
<ol>

  <li>
  <a href="http://www.python.org">Python.</a>
  Python is the main interface to Spheral++, and is absolutely required!  The
  odds are your system already has Python installed, but even if so I still
  recommend downloading and building your own for use with Spheral++.  The
  reason for this is that when you want to install extensions to Python for use
  with Spheral++, the default installation process for these extensions assumes
  you have write access to the Python directories (which is not the case with
  the system Python!)  It's also useful to be able to use an up to date version
  of Python, and system installations are often behind the times.

  <li><a href="http://www.gnuplot.info">Gnuplot</a> Gnuplot is current the
  standard 2-D plotting utility used in many of the Spheral++ test and demo
  scripts.  If your system already has Gnuplot installed, the system version
  should be OK.
  </li>

  <li><a href="http://www.pfdubois.com/numpy/">Numeric extension for Python</a></li>

  <li><a href="http://gnuplot-py.sf.net">Python interface to Gnuplot</a></li>

</ol>

Building both Numeric Python and the Gnuplot Python interface are *really*
simple, in most cases you should just have to run "python setup.py install",
but make sure you use the version of Python that you intend to run Spheral++
under!

Additionally, if you want to run the parallel version of Spheral++, you will need
<ol>
  <li>
  <a href="http://www-unix.mcs.anl.gov/mpi/mpich/">MPI</a>
  Parallel Spheral++ uses the Message Passing Interface (MPI) to coordinate
  parallel runs, so MPI is a must.  The standard vendor MPI on most parallel
  machines is fine, but if you need to you can install the freely available
  MPICH distribution from this link.
  </li>

  <li>
  <a href="http://sourceforge.net/projects/pympi">pyMPI.</a>
  The MPI enhanced version of Python.  Follow the directions on this page to
  download and build pyMPI.  When run in a distributed parallel mode,
  Spheral++ assumes a python process per processor, and requires that MPI be
  initialized before entering any Spheral++ module.  The parallel MPI enabled
  version of Python provides this functionality, and provides an "mpi" module
  that allows Python scripts to perform distributed operations (gather/scatter,
  reduction across processors, etc.)  This is required to run Spheral++ in
  parallel!
  </li>

  <li>
  <a href="http://www-users.cs.umn.edu/~karypis/metis/parmetis/index.html">
  ParMETIS.</a>
  ParMETIS is a parallel graph partitioning library, which Spheral++ uses to
  automatically partition (or domain decompose) an SPH distribution of nodes
  across processors.  The build system for ParMETIS is rather simple if
  low-tech: you simply edit the provided makefile filling in the appropriate
  compiler
  and associated flags for your system.  The resulting libraries (libmetis.a and
  libparmetis.a) and associated header file (parmetis.h) need to then be moved
  someplace Spheral++ can find them, as described in the configure section for
  <a href "#parmetis">"--with-parmetis="</a> configure flag below.
  </li>
</ol>

<hr>
<h3>
<a NAME="Building"></a>
<font color="#FF0000">Configuring and Building.</font>

<h4>Configuration</h4>
Thanks to Martin Casado, Spheral++ now has an autoconf build process.  In most
cases you should simply have to execute the following set of steps (in the
src/src directory):
<font color="pink">
<ol>
  <li> ./boot </li>
  <li> ./configure </li>
</ol>
</font color>
There are of course many options you can give to <font
color="pink">configure</font color>.  You can see these options by typing
"./configure --help".  The current set of options you may want to use include:
<ol>
  <li><font color="pink">--without-mpi</font color>
  Compile Spheral++ for a serial run.  Use this option if you don't want to
  use the parallel distributed version of Spheral++.
  </li>
  <li><font color="pink">--with-CXX=ARG</font color>
  Manually set C++ compiler to ARG.
  </li>
  <li><font color="pink">--with-CC=ARG</font color>
  Manually set C compiler to ARG.  Spheral++ does not currently use any C code,
  so this option actually has no effect.
  </li>
  <li><font color="pink">--with-LD=ARG</font color>
  Manually set linker to ARG.
  </li>
  <li><font color="pink">--with-python=ARG</font color>
  Use non-standard python (other than the default in your path).
  </li>
  <li><font color="pink">--with-opt=Val</font color>
  Set optimization level (0,1,2,3).  Note that on some platforms (notably IBM
  AIX we have found that compiling at high optimizations (>2) sometimes fails!
  </li>
  <li><font color="pink">--without-assert</font color>
  Turn off Design by Contract asserts.  Use this option if you are compiling for
  an optimized run, and don't want these internal consistency checks to slow down
  the run time performance.
  </li>
  <li><font color="pink">--with-timers</font color>
  Turn on the Timer class profiling.  This will generate a table of times
  used by different sections of the code during a run.
  </li>
  <li><font color="pink">--with-papi</font color>
  Activate PAPI for class profiling.  Must be used in conjunction with
  --with-timers, and produces more information about the run time performance.
  </li>
  <li><a NAME="parmetis"></a><font color="pink">--with-parmetis=DIR</font color>
  Indicates the base directory where the required ParMETIS files are stored.
  Under this directory should be the following structure:
  <ul>
    <li>DIR/include/parmetis.h</li>
    <li>DIR/lib/libmetis.a</li>
    <li>DIR/lib/libparmetis.a</li>
  </ul>
  </li>
  <li><font color="pink">--enable-postgres</font color>
  Enable support for PostgreSQL
  </li>
  <li><font color="pink">--with-postgres-programs=DIR</font color>
  Location of PostgreSQL executables.
  </li>
  <li><font color="pink">--with-postgres-includes=DIR</font color>
  Location of PostgreSQL includes.
  </li>
  <li><font color="pink">--with-postgres-libs=DIR</font color>
  location of PostgreSQL libraries.
  </li>
</ol>
This process presupposes you have Gnu autoconf installed on your system.  This
is probably true for most people, but if not please vist the <a
href="http://www.gnu.org/software/autoconf/autoconf.html">Gnu autoconf</a> site
and install autoconf.
<br>
Note -- if you are trying to compile on IBM AIX please consult the README.AIX
under src/.
<br><br>

<h4>Compile the code</h4>
At long last you should be ready to compile the code, so go into the "src/src"
directory and type "make".  The libraries automatically install under the
path specified in the <font color="pink">configure</font color> stage above.
Be warned, Spheral++ can severely exercise your compiler, so (particularly if
you are building optimized) it might take some time to build!
<br><br>

<h4><a NAME="Configure"></a>Configure your environment.</h4>
In order for your python process to find the Spheral++ components, you must set
the environment variables <font color="pink">PYTHONPATH</font color>
and <font color="pink">LD_LIBRARY_PATH</font color> to where you have
installed the Spheral++ components.  (On AIX this variable is actually called
<font color="pink">LIBPATH</font color>.)  Currently the Spheral++ process is
hardwired to place the modules you build into a <font color="pink">lib/</font
color> directory in the directory where you installed the Spheral++ source
code.

<hr>
<h3>
<a NAME="Tests"></a>
<font color="#FF0000">Running the Test Problems.</font>
</h3>
When you downloaded the Spheral++ source above, you also got the run scripts for
each of the tests presented in the tensor viscosity paper: they can be found
under the "src/results/TensorQ" directory.  Note that these runs were not
actually done in this directory structure, so in some cases the script may
require minor editing.  The various files found under this test directory are
briefly described in the README in "src/results/TensorQ".

To run the problems, you just make sure your environment is set up properly so
that python can find your Spheral++ libraries (<a href="#Configure">described
here</a>) and run python on one of the problem run scripts.  For instance, to
run the 2-D cylindrical Noh problem shown in Figure 1 a & b serially:
<ol>
<font color="pink">
  <li> cd src/results/TensorQ/Fig01/MG-Balsara </li>
  <li> python -i Noh-cylindrical-2d.py </li>
</font>
</ol>

Most of the problems presented in the paper were run in parallel, so the scripts
were set up with parallelism in mind.  If you want to run problems in parallel,
the invocation is system dependent depending on how MPI runs are handled on your
system.  In most cases you just use
<ol>
<font color="pink">
  <li> mpirun -np 4 pyMPI -i Noh-cylindrical-2d.py </li>
</font>
</ol>
or, on IBM AIX systems you will likely use
<ol>
<font color="pink">
  <li> poe pyMPI -i Noh-cylindrical-2d.py -nodes 1 -procs 4 </li>
</font>
</ol>
etc.

</body>
</html>
